package advent;

import java.util.HashMap;
import java.util.Map;
import java.util.function.Function;

public class Day19 {

    private static String inputString =
            "                                                                                                             |                                                                                           \n" +
                    "     +---+     +-------------------------------+         +---+     +---------+   +---------------------------|-------------------------------------------------------------------------+ +-----+         \n" +
                    "     |   |     |                               |         |   |     |         |   |                           |                                                                         | |     |         \n" +
                    "     |   +-----|---------+         +---------------------|---|-----|-------------|---------------------------|-------------------------------------------------------------------------+ |     +-------+ \n" +
                    "     |         |         |         |           |         |   |     |         |   |                           |                                                                           |             | \n" +
                    "     |     +---+     +---------+   |           |         |   | +-------------------------------------------------------------------------------------------------------+   A-+ +-----------------------+ \n" +
                    "     |     |         |   |     |   |           |         |   | |   |         |   |                           |                                                         |     | |         |               \n" +
                    "     |     |         |   |     |   |   +---------------------|-----|---------|-----------+                   |                     +-----------------------------------------------+     |               \n" +
                    "     |     |         |   |     |   |   |       |         |   | |   |         |   |       |                   |                     |                                   |     | |   |     |               \n" +
                    "     |     |         |   |     |   |   |       |         |   | |   +---------|-----------|-------------------|---------------------|-----------------------------------------|-----------|-------------+ \n" +
                    "     |     R         |   |     |   |   |       |         |   | |             |   |       |                   |                     |                                   |     | |   |     |             | \n" +
                    "     |     |         |   | +-------|---------------------------|-------------|-----------|-------------------|---------------------|-------------+         +-----------|-----|-----|-----+     +-------+ \n" +
                    "     |     |         |   | |   |   |   |       |         |   | |             |   |       |                   |                     |             |         |           |     | |   |           |         \n" +
                    "     |     +---------|-------+ |   |   |       |         |   +-|---------+ +-|---|-----+ | +-----------------|---------------------|-------+     |         |         +-|-----|-|---|-----------------+   \n" +
                    "     |               |   | | | |   |   |       |         |     |         | | |   |     | | |                 |                     |       |     |         |         | |     | |   |           |     |   \n" +
                    " +-------------------|-----|-|-|-------|-------|---------|-----+         | | |   |     | | +-----------------|---------------------------------------------|---------|---------|---|-----------+     |   \n" +
                    " |   |               |   | | | |   |   |       |         |               | | |   |     | |                   |                     |       |     |         |         | |     | |   |                 |   \n" +
                    " | +-----+           +---|---|-----|---|-----------------|-----------------|-----------|-|-------------------------------------+   |       |     |         +---------|-|---+ +-|---------------------+   \n" +
                    " | | |   |               | | | |   |   |       |         |               | | |   |     | |                   |                 |   |       |     |                   | |   |   |   |                     \n" +
                    " | +-+   |               | | | |   |   |       |         |               | | |   |     +---------------------|-----------------------------|-----|-------------------|-|---+   |   |                     \n" +
                    " |       |               | | | |   |   |       |         |               | | |   |       |                   |                 |   |       |     |                   | |       |   |                     \n" +
                    " |     +---------------------+ |   |   |       |         |               | | |   |     +-|-----------------------------------------|-------|-------------------------|-|-------|-------+             +-+ \n" +
                    " |     | |               | |   |   |   |       |         |               | | |   |     | |                   |                 |   |       |     |                   | |       |   |   |             | | \n" +
                    " |     | | +---------+   | |   |   |   |       |         |               | | |   |     | |                   |                 |   |       |     |                   | |       |   | +---------------+ | \n" +
                    " |     | | |         |   | |   |   |   |       |         |               | | |   |     | |                   |                 |   |       |     |                   | |       |   | | |               | \n" +
                    " +---+ | | | +-+     |   | |   |   +-----+     |       +-|---------------+ | | +-|-------|-------------------|-+               |   |       |     |                   | |       |   | | |               | \n" +
                    "     | | | | | |     |   | |   |       | |     |       | |                 | | | |     | |                   | |               |   |       |     |                   | |       |   | W |               | \n" +
                    " +-------|-|-|-|-+   |   | |   |       | +-------------|-------------------|-|-|-------|-|-------------------------------------|-----------|-----------------+       +-|-----------|-----------------+ | \n" +
                    " |   | | | | | | |   |   | |   |       |       |       | |                 | | | |     | |                   | H               |   |       |     |           |         |       |   | | |             | | \n" +
                    " |   | +-|-------+   |   | |   |       |       |       | |                 | | | |     | |         +---------|---------------------|-------|-----|---------------------------------|-|---------------+ | \n" +
                    " |   |   | | | |     |   | |   |       |       |       | |                 | | | |     | |         |         | |               |   |       |     |           |         |       |   | | |               | \n" +
                    " |   +-----|-|---+   |   | |   +---+   |       |       +-|-----------------------|-----|-------+   |         | |               |   |       |     |           |         |       |   +-|-|-------------+ | \n" +
                    " |       | | | | |   |   | |       |   |       |         |                 | | | |     | |     |   |         | |               |   |       |     |           |         |       |     | |             | | \n" +
                    " |       | | | | |   |   | |       |   |       |         |                 | | | |     | |     |   |         | +-------------------|-------|-----|---------+ |         | +---------------+           | | \n" +
                    " |       | | | | |   |   | |       |   |       |         |                 | | | |     | |     |   |         |                 |   |       |     |         | |         | |     |     | | |           | | \n" +
                    " |       | | | | |   |   | |       |   | +-+   |         |                 | | | |     | |     +-------------|-----------------|-+ |       |     |         | |         | |     |     | | |           | | \n" +
                    " |       | | | | |   |   | |       |   | | |   |         |                 | | | |     | |         |         |                 | | |       |     |         | |         | |     |     | | |           | | \n" +
                    " |       | | | | |   |   | |     +-----------------------------------------|-----|-------|---------|---------|-----------+     | | |       |     |         | |         | |     |     | | |           | | \n" +
                    " |       | | | | |   |   | |     | |   | | |   |         |                 | | | |     | |         |         |           |     | | |       |     |         | |         | |     |     | | |           | | \n" +
                    " |     +-|-|-|-+ |   |   | |   +-|-|-------|-------------------------------|-|---|-----|-|---------|---------|-----------|-------|-+       |     |         | |         | | +-+ |     | | |         +-+ | \n" +
                    " |     | | | |   |   |   | |   | | |   | | |   |         |                 | | | |     | |         |         |           |     | |         |     |         | |         | | | | |     | | |         |   | \n" +
                    " |   +-|---------|-+ | +---------|-|---|-+ |   | +-------+         +-------|-|---------|---------------------|-----------|-----------------------------------|---+     | | | | |     | | |         |   | \n" +
                    " |   | | | | |   | | | | | |   | | |   |   |   | |                 |       | | | |     | |         |         |           |     | |         |     |         | |   |     | | | | |     | | |         |   | \n" +
                    " |   | | | | |   | | | | | |   | | |   |   |   | |                 |       | | | |     | |         |         |           | +-------------------------------------------|-----|-|-------|---+       |   | \n" +
                    " |   | | | | |   | | | | | |   | | |   |   |   | |                 |       | | | |     | |         |         |           | |   | |         |     |         | |   |     | | | | |     | | | |       |   | \n" +
                    " |   | | | | |   | | | | | | +---------|---|-----|-------------------------------------|-----------|---------------------|-|---|-|---------|-----|---------------|-----+ | | | |     | | | |       |   | \n" +
                    " |   | | | | |   | | | | | | | | | |   |   |   | |                 |       | | | |     | |         |         |           | |   | |         |     |         | |   |       | | | |     | | | |       |   | \n" +
                    " |   +-----|-|---|-|-|---|-|-----+ |   |   |   | |                 |       | | | |     | |         |         |           | |   | |         |     |         | |   |       | | | |     | | | |       |   | \n" +
                    " |     | | | |   | | | | | | | |   |   |   |   | |                 |       | | | |     | |         |         |           | |   | |         |     |         | |   |       | | | |     | | | |       |   | \n" +
                    " |     +-|-|-|---|---|-|-|-------+ |   |   |   | |                 +-----+ | | | |     | |       +---------------------+ | |   | |         |     |         | +-------------|-|---------|---|-----------+ \n" +
                    " |       | | |   | | | | | | | | | |   |   |   | |                       | | | | |     | |       | |         |         | | |   | |         |     |         |     |       | | | |     | | | |       |     \n" +
                    " |       | | |   | | | | | | | | | | +-----------|-----------------------|-|---------------------|---------------------|-----------+ +-----------|---------+     |       | | | |     | | | |       |     \n" +
                    " |       | | |   | | | | | | | | | | | |   |   | |                       | | | | |     | |       | |         |         | | |   | | | |     |     |               |       | | | |     | | | |       |     \n" +
                    " +-------|-|-|-----+ | | | | | | | | | |   |   | |                       | | | | |     | |       | |         |         | | |   | | | |     |     |               |       +-|---|-+   | | | |       |     \n" +
                    "         | | |   |   | | | | | | | | | |   |   | |                       | | | | |     | |       | |         |         | | |   | | | |     |     |               |         | | | |   | | | |       |     \n" +
                    "         | +-------+ | | | | | | | | | +---------|-------------------------------+     | |       | |         |         | | |   | | | |     |     |               |         | | | |   | | | |   +---+     \n" +
                    "         |   |   | | | | | | | | | | |     |   | |                       | | | |       | |       | |         |         | | |   | | | |     |     |               |         | | | |   | | | |   |         \n" +
                    "         |   |   +-|-|-----|---|-|-|-|-------------------------------------|-|-------------------------------|---------|-|-|-----|-|-------------+               |         | | | |   | | +-------------+ \n" +
                    "         |   |     | | | | | | | | | |     |   | |                       | | | |       | |       | |         |         | | |   | | | |     |                     |         | | | |   | |   |   |       | \n" +
                    "   +---------|---+ | | | | | | | +-----+   |   | |                       | | | |     +-|-|-------------------|---------|---|-----|---|-----|-----------------------+       | | | |   | |   |   |       | \n" +
                    "   |     |   |   | | | | | | | |   | | |   |   | |                       | | | |     | | |       | |         |         | | |   | | | |     |                     | |       | | | |   | |   |   |       | \n" +
                    "   |     |   |   | | | | | | | | +---|---------------------------------------|---+   | | |       | |         |         | | |   | | | |     |                     | |       | | | |   | |   |   |       | \n" +
                    "   |     |   |   | | | | | | | | | | | |   |   | |                       | | | | |   | | |       | |         |         | | |   | | | |     |                     | |       | | | |   | |   |   |       | \n" +
                    "   |     |   |   | | | | | | | | | | | |   |   | |                       | | | | |   | | |       | |         |         | | |   | | | |     |                     | |       | | | |   | |   |   |       | \n" +
                    "   |     |   |   | | | | | | | | | | | |   |   | |                       | | | | |   | | |       | |         |         | | |   | | | |     |                     | |       | | | |   | |   |   |       | \n" +
                    "   |     |   +-----|-|---------|-|---------------|-----------------------|-|---------|-|-|-------------------|-+       | | |   | | | |     |                     | |       | | | |   | |   |   |   +-+ | \n" +
                    "   |     |       | | | | | | | | | | | |   |   | |                       | | | | |   | | |       | |         | |       | | |   | | | |     |                     | |       | | | |   | |   |   |   | | | \n" +
                    " +---------------|-----|---------------|---|---|---------+         +-----+ | | | +-----|-|-------|-+   +---------------|-|-|---|-|---------|---------------------|-|-----------|-----|-----|---|-+ | | | \n" +
                    " | |     |       | | | | | | | | | | | |   |   | |       |         |       | | |     | | |       |     |     | |       | | |   | | | |     |                     | |       | | | |   | |   |   | | | | | \n" +
                    " | |     |       | +-|-------|-|---|---|-------|---------|-------------------|-|---------|-------------------------------|-----|-|-|-|---------------------------|---------|-----|---|-----|-+ | | | | | \n" +
                    " | |     |       |   | | | | | | | | | |   |   | |       |         |       | | |     | | |       |     |     | |       | | |   | | | |     |                     | |       | | | |   | |   | | | | | | | \n" +
                    " | |     |       | +-|---|---|-|-+ | | | +-----|-|-------|---------------------|-+   | | | +-----------|-------|---------|-|-----|-|-------|-------+             | | +-+   | +-|-|-----|-+ | | | | | | | \n" +
                    " | |     |       | | | | | | | |   | | | | |   | |       |         |       | | | |   | | | |     |     |     | |       | | |   | | | |     |       |             | | | |   |   | |   | | | | | | | | | | \n" +
                    " | |     | +-+   | | | | | | | |   | | | | |   | |       |   +-----|-----------------|-|---|-----|-----------|-----+   | | |   | | | |     |       |             | | | |   |   | |   | | | | | | | | | | \n" +
                    " | |     | | |   | | | | | | | |   | | | | |   | |       |   |     |       | | | |   | | | |     |     |     | |   |   | | |   | | | |     |       |             | | | |   |   | |   | | U | | | | | | | \n" +
                    " | |     | | |   | | | | | | | | +-----|-|-------|-----------|-----------------------------------------|---+ | |   |   | | |   | | | |     |       |             | | | |   |   | |   | | | | | | | | | | \n" +
                    " | |     | | |   | | | | | | | | | | | | | |   | |       |   |     |       | | | |   | | | |     |     |   | | |   |   | | |   | | | |     |       |             | | | |   |   | |   | | | | | | | | | | \n" +
                    " | |     | | |   | | | | +-----|-|---|-|---|-----|-----------|-----|-------|---|-|---|-|-|-----------+ |   | | |   |   | | |   | | | |     |       |             | | | |   |   | |   | | | | | | | | | | \n" +
                    " | |     | | |   | | | |   | | | | | | | | |   | |       |   |     |       | | | |   | | | |     |   | |   | | |   |   | | |   | | | |     |       |             | | | |   |   | |   | | | | | | | | | | \n" +
                    " | |     | | |   | | | |   | | | | | | | | |   | |       |   |     |       | | | |   | | | | +---|---|-|-----------|---|-|-|-------|-|-----|-------|-------------------|----------------E--+ | | | | | | \n" +
                    " | |     | | |   | | | |   | | | | | | | | |   | |       |   |     |       | | | |   | | | | |   |   | |   | | |   |   | | |   | | | |     |       |             | | | |   |   | |   | | |   | | | | | | \n" +
                    " | |     | | |   | | | |   | | | | | | | | |   | +-------|---|---------------|-------|-----|---+ |   | | +-|-------|---|-|-|---|-|-|-----------------------------|---|-----|-----|-------+ +---|-------+ \n" +
                    " | |     | | |   | | | |   | | | | | | | | |   |         |   |     |       | | | |   | | | | | | |   | | | | | |   |   | | |   | | | |     |       |             | | | |   |   | |   | |   | | | | | |   \n" +
                    " | |     | | |   | +---|---|-|-|-|---|---|-----|---------------------------|-|-------|---|---+ | +---|---|-|-------|-----|-|-+ | | | +-----+       |             | | | |   |   | |   | |   | | | | | |   \n" +
                    " | |     | | |   |   | |   | | | | | | | | |   |         |   |     |       | | | |   | | | |   |     | | | | | |   |   | | | | | | |               |             | | | |   |   | |   | |   | | | | | |   \n" +
                    " | | +---|-|-+   |   | |   | | | | | | | | |   |         |   |     |       | | | |   | | | |   |     | | | | | |   |   | | | | | +-|-----------------------------|-|-|---------------|-------|-----|---+ \n" +
                    " | | |   | |     |   | |   | | | | | | | | |   |         |   |     |       | | | |   | | | |   |     | | | | | |   |   | | | | |   |               |             | | | |   |   | |   | |   | | | | | | | \n" +
                    " | | |   | |     |   | |   | | | | | | | | |   | +-----------------|-----------|-----------|-----------------------|-------|-|-|-----------------------+         | | | |   |   | |   | |   | | | | | | | \n" +
                    " | | |   | |     |   | |   | | | | | | | | |   | |       |   |     |       | | | |   | | | |   |     | | | | | |   |   | | | | |   |               |   |         | | | |   |   | |   | |   | | | | | | | \n" +
                    " | | |   | |     |   | |   | | | | | | | | |   | | +---------------|-------------|---|---|-|---------|-|---------------|---|-|-----|-------------------|-----------|---|---|---------|-+ +-|-+ | | | | | \n" +
                    " | | |   | |     |   | |   | | | | | | | | |   | | |     |   |     |       | | | |   | | | |   |     | | | | | |   |   | | | | |   |               |   |         | | | |   |   | |   |   | |   | | | | | \n" +
                    " | | +---|-|-----|-----|---|---|---------|-|-----------------|---------------|-------------|-------------|-|---|---------|-----|-----------------------------+   | | | |   |   | |   |   | |   | | | | | \n" +
                    " | |     | |     |   | |   | | | | | | | | |   | | |     |   |     |       | | | |   | | | |   |     | | | | | |   |   | | | | |   |               |   |     |   | | | |   |   | |   |   | |   | | | | | \n" +
                    " | |     | |     |   | |   | | | | | | | | |   | | |     |   |     |       | | | |   | | | |   |   +---------|-----|-----|-----------------------------------|---|-|---|---------|-+ |   | |   | | | | | \n" +
                    " | |     | |     |   | |   | | | | | | | | |   | | |     |   |     |       | | | |   | | | |   |   | | | | | | |   |   | | | | |   |               |   |     |   | | | |   |   | | | |   | |   | | | | | \n" +
                    " | |     | |     |   | |   | | | | | | | | |   | | |     |   | +---|---------|-|-|-+ | | | |   |   | | | | | | |   |   | | | | |   |               |   |     |   | | | |   |   | | | |   | | +-|---|---+ \n" +
                    " | |     | |     |   | |   | | | | | | | | |   | | |     |   | |   |       | | | | | | | | |   |   | | | | | | |   |   | | | | |   |               |   |     |   | | | |   |   | | | |   | | | | | | |   \n" +
                    " | |     | |     | +-|-----|---|-|---|---|-|---------------+ | | +-|-------|-------|-----------+   +-|-|-|-|---|-------|-|---|---------------------|-------+ |   | +---+   |   | +-|-----|---+ | | | |   \n" +
                    " | |     | |     | | | |   | | | | | | | | |   | | |     | | | | | |       | | | | | | | | |         | | | | | |   |   | | | | |   |               |   |   | |   |   |     |   |   | |   | |   | | | |   \n" +
                    " | | +-----------|-|-|---------|-|---|---|-----|-|---------------|-----+   | | | | | +-|-|-----+   +-|-|-|---|-|---+   | | | | |   |               |   |   | |   |   |     |   |   | |   | |   | | | |   \n" +
                    " | | |   | |     | | | |   | | | | | | | | |   | | |     | | | | | |   |   | | | | |   | | |   |   | | | | | | |       | | | | |   |               |   |   | |   |   |     |   |   | |   | |   | | | |   \n" +
                    " | | |   | +-+   | | | |   | | | | | | | | |   | | |     | | | | | |   |   | | | | |   | | |   |   | | | | | | |       | | | | |   |               |   |   | |   |   |     |   |   | |   | |   | | | |   \n" +
                    " | | |   |   |   | | | |   | | | | | | | | |   | | |     | | | | | |   |   | | | | |   | | |   |   | | | | | | |       | | | | |   |               |   |   | |   |   |     |   |   | |   | |   | | | |   \n" +
                    " | | |   |   |   | | | |   | | | | | | | | |   | | |     | | | | | |   |   | | | +-----|-+ | +-------+ | | +-----------|-|-------------------------+   |   | |   |   |     |   |   | |   | |   | | | |   \n" +
                    " | | |   |   |   | | | |   | | | | | | | | |   | | |     | | | | | |   |   | | |   |   |   | | |   |   | |   | |       | | | | |   |                   |   | |   |   |     |   |   | |   | |   | | | |   \n" +
                    " | | |   |   |   | | | | +---|---------+ | | +-|-|-|-------|-----|-|-----------|-------------|-|---|---|-----+ |       | | | | |   |                   |   | |   |   | +---|---|-+ | |   | |   | | | |   \n" +
                    " | | |   |   |   | | | | | | | | | | |   | | | | | |     N | | | | |   |   | | |   |   |   | | |   |   | |     |       | | | | |   |                   |   | |   |   | |   |   | | | |   | |   | | | |   \n" +
                    " | | |   |   |   | | | | | | | | | | |   | | | | +-|-----|---|-+ | | +-----|---|-------------|-|-------+ |     |   +---|---|-|-----|-----------------------------|---|-|--D|---|-----|---+ |   | | | |   \n" +
                    " | | |   |   |   | | | | | | | | | | |   | | | |   |     | | |   | | | |   | | |   |   |   | | |   |     |     |   |   | | | | |   |                   |   | |   |   | |   |   | | | |     |   | | | |   \n" +
                    " | | |   |   +---|---|-|-----|-|-|-|-----|-|---|-----------|-|-----|-|-----|-|-----|---|-------|---------------|-------|-|---------|-------------------|---------|-----|---|---|-|---|-----|---|-+ | |   \n" +
                    " | | |   |       | | | | | | | | | | |   | | | |   |     | | |   | | | |   | | |   |   |   | | |   |     |     |   |   | | | | |   |                   |   | |   |   | |   |   | | | |     |   |   | |   \n" +
                    " | | |   |       | | | | | | | | | | |   | | | |   |     | +-------|-|-----|-|-|-----------|-|-+   |     |     |   |   | | | | |   |               +-------|---------+ |   |   | | | |   +-------+ | |   \n" +
                    " | | |   |       | | | | | | | | | | |   | | | |   |     |   |   | | | |   | | |   |   |   | |     |     |     |   |   | | | | |   |               |   |   | |   |     |   |   | | | |   | |   | | | |   \n" +
                    " | | |   | +-------|---+ | | | | | | |   | | | |   |     |   |   | | | |   | | |   |   |   +-+   +-|-----|-----|---+   | | | | |   |       +-------|---------|---------+   |   | | | |   | |   | | | |   \n" +
                    " | | |   | |     | | |   | | | | | | |   | | | |   |     |   |   | | | |   | | |   |   |         | |     |     |       | | | | |   |       |       |   |   | |   |         |   | | | |   | |   | | | |   \n" +
                    " | | | +---|-------+ | +-----------|-------|-----+ |     |   |   | | | |   | | |   |   |         | |     |     |       | | | | |   |       |       |   |   | |   |         |   | +---|---+ |   | | | |   \n" +
                    " | | | | | |     |   | | | | | | | | |   | | | | | |     |   |   | | | |   | | |   |   |         | |     |     |       | | | | |   |       |       |   |   | |   |         |   |   | |     |   | | | |   \n" +
                    " | | | +-|-|-----|-------|-|-|-----|-----------|-+ |     |   |   | | | |   | +-|-------+         | |   +---------------+ | +-+ |   |       |       |   |   | |   |         |   |   | |     |   | | | |   \n" +
                    " | | |   | |     |   | | | | | | | | |   | | | |   |     |   |   | | | |   |   |   |             | |   | |     |         |     |   |       |       |   |   | |   |         |   |   | |     |   | | | |   \n" +
                    " | | +---|-----------|-------|-+ | | |   | | | |   |     |   |   | | | |   |   |   |             | |   | |     |         |     |   |       |       |   |   | +---|-------------|---+ |     |   | | | |   \n" +
                    " | |     | |     |   | | | | |   | | |   | | | |   |     |   |   | | | |   |   |   |             | |   | |     |         |     |   |       |       |   |   |     |         |   |     |     |   | | | |   \n" +
                    " | | +---|-------|-----|---|-------------|-|---|---|---------|---|---|-|-----+ |   |   +---------|-|---|-|-----|-------------------|-------|-------+   |   |     |         |   |     |     |   | | | |   \n" +
                    " | | |   | |     |   | | | | |   | | |   | | | |   |     |   |   | | | |   | | |   |   |         | |   | |     |         |     |   |       |           |   |     |         |   |     |     |   | | | |   \n" +
                    " | | |   | |     |   | | | | |   | | | +---|-|-----|---------------|-|---------|---|---|---------|-|---------------------|-----|---|-------+           |   |     |         |   |     |   +-|---|-+ | |   \n" +
                    " | | |   | |     |   | | | | |   | | | | | | | |   |     |   |   | | | |   | | |   |   |         | |   | |     |         |     |   |                   |   |     |         |   |     |   | |   |   | |   \n" +
                    " | | |   | |     |   | | | | |   | | | | | | | |   |     |   |   | | | |   | | |   |   |         | |   | |     |         |     |   |                   |   |     |         |   |   +-----|-------+ | |   \n" +
                    " | | |   | |     |   | | | | |   | | | | | | | |   |     |   |   | | | |   | | |   |   |         | |   | |     |         |     |   |                   |   |     |         |   |   | |   | |   | | | |   \n" +
                    " | | |   | |     |   | | | | |   | | | | | | | |   |     |   |   +-|-------|---|---|---|---------|-----+ |     |         |     |   |                   |   |     |         |   |   | |   | |   | | | |   \n" +
                    " | | |   | |     |   | | | | |   | | | | | | | |   |     |   |     | | |   | | |   |   |         | |     |     |         |     |   |                   |   |     |         |   |   | |   | |   | | | |   \n" +
                    " | | | +-|-+     |   | | | | |   | | | | | | | |   |     |   |     | | |   | | |   |   +-----------------|-----|---------|-----------------------------|---------|-------------|---|-|---|-|-----+ | |   \n" +
                    " | | | | |       |   | | | | |   | | | | | | | |   |     |   |     | | |   | | |   |             | |     |     |         |     |   |                   |   |     |         |   |   | |   | |   |   | |   \n" +
                    " | | | | |       |   | | | | |   | | | | | | | |   |     |   |     | | |   | | +-----------------|-------------|---------|-----+   |                   |   +---------------|---|---|-+   | |   |   | |   \n" +
                    " | | | | |       |   | | | | |   | | | | | | | |   |     |   |     | | |   | |     |             | |     |     |         |         |                   |         |         |   |   |     | |   |   | |   \n" +
                    " | | | | | +-------------|-|-|-----|---|---|-|-|---------|---|---------|---------------------------|-----|-----|---------|---------|-------------------|---------|---------+   |   |     | |   |   | |   \n" +
                    " | | | | | |     |   | | | | |   | | | | | | | |   |     |   |     | | |   | |     |             | |     |     |         |         |                   |         |             |   |     | |   |   | |   \n" +
                    " | | | | | +---------|-+ | +-----|-|-|---|-|-|---+ |     |   |     | | |   | |     +---------------------------|-------------------|-------------+     +---------|----------Y--+   |     | |   | +---|-+ \n" +
                    " | | | | |       |   |   |   |   | | | | | | | | | |     |   |     | | |   | |                   | |     |     |         |         |             |               |                 |     | |   | | | | | \n" +
                    " | | | | |       | +-|---|-----------|---------|---------|---|---------|---|-----+           +---|-|-----|-----|---------+         |             |   +-----------------------------+     | |   | | | | | \n" +
                    " | | | | |       | | |   |   |   | | | | | | | | | |     |   |     | | |   | |   |           |   | |     |     |                   |             |   |           |                       | |   | | | | | \n" +
                    " | | | | |       | | |   |   |   | | | | | +-----|-|-----|---|-------|-|---|-----|-----------------------------|---------------------------------|---|-------------------------------------|-----+ | | | \n" +
                    " | | | | |       | | |   |   |   | | | | |   | | | |     |   |     | | |   | |   |           |   | |     |     |                   |             |   |           |                       | |   |   | | | \n" +
                    " | | | | |       | | |   | +-|---|-------|-------|-|-----|---|-----|---------+   |           |   | |     +-------------+           |             |   |           |                       | |   |   | | | \n" +
                    " | | | | |       | | |   | | |   | | | | |   | | | |     |   |     | | |   |     |           |   | |           |       |           |             |   |           |                       | |   |   | | | \n" +
                    " | +-|---|-------|-------|---|-----|-|-------|-|-|-|---------------|-|-----|-----|---------------|-|-----------|-------|-----------|-------------|---|-----------|-------------------------------+ | | | \n" +
                    " |   | | |       | | |   | | |   | | | | |   | | | |     |   |     | | |   |     |           |   | |           |       |           |             |   |           |                       | |   | | | | | \n" +
                    " |   | | | +---------|-------|---|-|-|-|---------|-|-----|---|-----|---|---|-----------------|---|-------------|---------------+   |             |   |           |                       +-+   | | | +-+ \n" +
                    " |   | | | |     | | |   | | |   | | | | |   | | | |     |   |     | | |   |     |           |   | |           |       |       |   |             |   |           |                             | | |     \n" +
                    " |   +-|-|---+   | | |   | | |   | | | | |   | | | |     |   |     | | |   |     |           |   | |           |       |       +---|-----------------|---------------------------------------------|---+ \n" +
                    " |     | | | |   | | |   | | |   | | | | |   | | | |     |   |     | | |   |     |           |   | |           |       |           |             |   |           |                             | | |   | \n" +
                    " |     | | | |   | | |   | | |   | | | | |   | | | +---+ |   |     | | +---+     |           |   | |           |       |           |         +---|-----------+   |                             | | | +-+ \n" +
                    " |     | | | |   | | |   | | |   | | | | |   | | |     | |   |     | |           |           |   | |           |       |           |         |   |   |       |   |                             | | | |   \n" +
                    " |     | | | |   +-|-+   | | |   | | | | |   | | |     | |   |     | |           |           |   | |           |       |           |         |   |   |       |   |                 +-----------|-|---+   \n" +
                    " |     | | | |     |     | | |   | | | | |   | | |     | |   |     | |           |           |   | |           |       |           |         |   |   |       |   |                 |           | | |     \n" +
                    " |   +-|---|-------------|---|---|-|---------------+   | |   |     | |           |           |   | |           |       |           |         |   |   |       +---|-----------------|-----+     | | |     \n" +
                    " |   | | | | |     |     | | |   | | | | |   | | | |   | |   |     | |           |           |   | |           |       |           |         |   |   |           |                 |     |     | | |     \n" +
                    " |   | | | | |     |     | | |   | | | | |   | | | |   | |   |     | |           |           |   | |           |       |           |         |   |   |           |                 |     |     | | |     \n" +
                    " |   | | | | |     |     | | |   | | | | |   | | | |   | |   |     | |           |           |   | |           |       |           |         |   |   |           |                 |     |     | | |     \n" +
                    " |   | | | +-------|-----|-|-|---|-|---+ +---|-|-------|-|---------|-|-----------|---------------|-|---+       |       |           |         |   |   |           |                 | +---|-------|-+     \n" +
                    " |   | | |   |     |     | | |   | | |       | | | |   | |   |     | |           |           |   | |   |       |       |           |         |   |   |           |                 | |   |     | |       \n" +
                    " | +-+ | | +-|-----------|-|-----|---|---------+ | |   | |   |     | |           |           |   | |   |       |       |           |         |   +---------------|-----------------|-+   |     | |       \n" +
                    " | |   | | | |     |     | | |   | | |       |   | |   | |   |     | |           |           |   | |   |       |       |           |         |       |           |                 |     |     | |       \n" +
                    " | |   | | | |     |     | | |   | | |       +---|-|---|-|---|-----|-|-----------------------|---|-----|-------|-------|-----------|---------|-------------------|-----+           |     |     | |       \n" +
                    " | |   | | | |     |     | | |   | | |           | |   | |   |     | |           |           |   | |   |       |       |           |         |       |           |     |           |     |     | |       \n" +
                    " | |   | | | |     |     | | |   | | |           | |   | |   +-----------------------------------|-----------+ |       |           |         |       |           |     |           |     |     | |       \n" +
                    " | |   | | | |     |     | | |   | | |           | |   | |         | |           |           |   | |   |     | |       |           |         |       |           |     |           |     |     | |       \n" +
                    " | |   | | | +-----|-----|---|O------------------|-|---|-|---+     | |           |           |   | |   |     | |       |           |         |       |           |     |           |     |     | |       \n" +
                    " | |   | | |       |     | | |   | | |           | |   | |   |     | |           |           |   | |   |     | |       |           |         |       |           |     |           |     |     | |       \n" +
                    " | |   | +-|---------------|-----|---|-----------|-----|-|---+     | |           |           |   | |   |     | |       |           |         |       |     +-----|-----|-----------+     +-----+ |       \n" +
                    " | |   |   |       |     | | |   | | |           | |   | |         | |           |           |   | |   |     | |       |           |         |       |     |     |     |                         |       \n" +
                    " | |   +-----------|-----+ | |   | | |           | |   | |         | +-----------|-----------|-------------------------|-----------------------------|-----------------|-------------------------+       \n" +
                    " | |       |       |       | |   | | |           | |   | |         |             |           |   | |   |     | |       |           |         |       |     |     |     |                                 \n" +
                    " | | +-------------|-------|-----|-|-|-----------------|-|-----------------------------------|-----|---|-----|---------|-----------------------------|-----------|---------------------+                 \n" +
                    " | | |     |       |       | |   | | |           | |   | |         |             |           |   | |   |     | |       |           |         |       |     |     |     |               |                 \n" +
                    " | | |     |       |       | |   | | |           | +-----------------+           |           |   | |   |     | |       |           |         |       |     |     |     |               |                 \n" +
                    " | | |     |       |       | |   | | |           |     | |         | |           |           |   | |   |     | |       |           |         |       |     |     |     |               |                 \n" +
                    " | | | +-+ +-----+ +---------|-----|-------------------|-----------|-----------------+       |   | |   |     | |       |           |         |       |     |     |     |               |                 \n" +
                    " | | | | |       |         | |   | | |           |     | |         | |           |   |       |   | |   |     | |       |           |         |       |     |     |     |               |                 \n" +
                    " | | | | |   +-----------+ | |   +-|-|-----------|-----+ |         | |           |   |       |   | |   |     | |       |           |         |       |     |     |     |               |                 \n" +
                    " | | | | |   |   |       | | |     | |           |       |         | |           |   |       |   | |   |     | |       |           |         |       |     |     |     |               |                 \n" +
                    " | | | | | +-|-+ |       +-|-+     | |           |       |         | |           |   |       |   | |   |     | |       |           |         |   +---|-----+     |     |               |                 \n" +
                    " | | | | | | | | |         |       | |           |       |         | |           |   |       |   | |   |     | |       |           |         |   |   |           |     |               |                 \n" +
                    " | | | | | | | | +-----+   +---------|-----------|-------|---------|-------+     |   |       |   +-+   | +-------------------------|-------------|---|-----------|---------------------+                 \n" +
                    " | | | | | | | |       |           | |           |       |         | |     |     |   |       |         | |   | |       |           |         |   |   |           |     |                                 \n" +
                    " | | | | | | | |       |           | |           |       |         | +-----+     |   |       |         | |   | |       |           |         |   |   |           |     |                                 \n" +
                    " | | | | | | | |       |           | |           |       |         |             |   |       |         | |   | |       |           |         |   |   |           |     |                                 \n" +
                    " | +-+ | | | +-----------------------|-----------|-------|---------|-------+   +-|---+     +-----------+ |   | |       +-------------------------|-+ |           |     |                                 \n" +
                    " |     | | |   |       |           | |           |       |         |       |   | |         | |           |   | |                   |         |   | | |           |     |                                 \n" +
                    " |     | | +---|-------|-+         | |           |       |         |       |   | |         | |           |   | |                   |         |   | | |           |     |                                 \n" +
                    " |     | |     |       | |         | |           |       |         |       |   | |         | |           |   | |                   |         |   | | |           |     |                                 \n" +
                    " +-------|-------------|-------------|-------------------|---------|---------+ | |         | +-----------|-----+                   |         |   | | |           |     |                                 \n" +
                    "       | |     |       | |         | |           |       |         |       | | | |         |             |   |                     |         |   | | |           |     |                                 \n" +
                    "       +-|-+   |   +---|-+         | |           +-----------------|---------+ | +---------+             |   |                     |         |   | | |           |     |                                 \n" +
                    "         | |   |   |   |           | |                   |         |       |   |                         |   |                     |         |   | | |           |     |                                 \n" +
                    "         | +---+   +---------+     | +---------------------------------------+ |         +---------------+   |                     |         |   | | |           |     +-------------------+             \n" +
                    "         |             |     |     |                     |         |       | | |         |                   |                     |         |   | | |           |                         |             \n" +
                    "         +-+           +-----+     +---------------------|---------|-----------+         +-------------------|-------------------------------+   +-+ |           |                         |             \n" +
                    "           |                                             |         |       | |                               |                     |                 |           |                         |             \n" +
                    "           |                                             +-------------------+                               |                     |                 +-----------+                         |             \n" +
                    "           |                                                       |       |                                 |                     |                                                       |             \n" +
                    "           +-------------------------------------------------------+       +---------------------------------+                     +-------------------------------------------------------+             \n" +
                    "                                                                                                                                                                                                         \n";

    public static class Coord {
        int x;
        int y;

        public Coord(int x, int y) {
            this.x = x;
            this.y = y;
        }
    }

    public static void main(String[] args) {
        System.out.println(prob1(inputString));
        System.out.println(prob2(inputString));
    }

    public static String prob1(String input) {
        StringBuilder sb = new StringBuilder();
        String[] rows = input.split("\\r?\\n");
        char[][] grid = new char[rows.length][rows[0].length()];
        int i = 0;
        for (String row : rows) {
            grid[i] = row.toCharArray();
            i++;
        }
        Function<Coord, Coord> direction = addY;
        int startIndex = findStartIndex(grid[0]);
        Coord current = new Coord(startIndex, 0);
        while (grid[current.y][current.x] != ' ') {
            current = direction.apply(current);
            char currentChar = grid[current.y][current.x];
            if (currentChar == '+') {
                direction = newDirection(grid, direction, current);
            } else if (currentChar != '|' && currentChar != '-' && currentChar != ' ') {
                sb.append(currentChar);
            }
        }
        return sb.toString();
    }

    private static Function<Coord, Coord> newDirection(char[][] grid, Function<Coord, Coord> direction, Coord current) {
        if (direction == addX || direction == decX) {
            Character addC = safeAccess(grid, current.x, current.y + 1);
            Character decC = safeAccess(grid, current.x, current.y - 1);
            if (addC != null && !addC.equals('+') && !addC.equals('-') && !addC.equals(' ')) {
                return addY;
            }
            if (decC != null && !decC.equals('+') && !decC.equals('-') && !decC.equals(' ')) {
                return decY;
            }
        } else if (direction == addY || direction == decY) {
            Character addC = safeAccess(grid, current.x + 1, current.y);
            Character decC = safeAccess(grid, current.x - 1, current.y);
            if (addC != null && !addC.equals('+') && !addC.equals('|') && !addC.equals(' ')) {
                return addX;
            }
            if (decC != null && !decC.equals('+') && !decC.equals('|') && !decC.equals(' ')) {
                return decX;
            }
        }
        throw new IllegalStateException();
    }

    private static Character safeAccess(char[][] grid, int x, int y) {
        try {
            return grid[y][x];
        } catch (Exception e) {
            return null;
        }
    }

    private static Function<Coord, Coord> addX = coord -> new Coord(coord.x + 1, coord.y);
    private static Function<Coord, Coord> addY = coord -> new Coord(coord.x, coord.y + 1);
    private static Function<Coord, Coord> decX = coord -> new Coord(coord.x - 1, coord.y);
    private static Function<Coord, Coord> decY = coord -> new Coord(coord.x, coord.y - 1);

    private static int findStartIndex(char[] chars) {
        for (int i = 0; i < chars.length; i++) {
            if (chars[i] == '|') return i;
        }
        return -1;
    }

    public static int prob2(String input) {
        int count = 0;
        String[] rows = input.split("\\r?\\n");
        char[][] grid = new char[rows.length][rows[0].length()];
        int i = 0;
        for (String row : rows) {
            grid[i] = row.toCharArray();
            i++;
        }
        Function<Coord, Coord> direction = addY;
        int startIndex = findStartIndex(grid[0]);
        Coord current = new Coord(startIndex, 0);
        while (grid[current.y][current.x] != ' ') {
            count++;
            current = direction.apply(current);
            char currentChar = grid[current.y][current.x];
            if (currentChar == '+') {
                direction = newDirection(grid, direction, current);
            }
        }
        return count;
    }
}
